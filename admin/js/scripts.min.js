function tableDNDinit(){$("#dnd").tableDnD({onDragClass:"myDragClass",onDrop:function(a,b){var c=a.tBodies[0].rows,d=parseInt(a.start.replace("o","").replace(" odd","").replace(" mark","")),e={orderStr:"",table:$("#dnd").find("tbody").attr("class"),act:2};for(var f=0;f<c.length;f++){e.orderStr+=c[f].id+"-"+(d+f)}$("#dnd tbody").find("tr").each(function(a){$(this).removeClass().addClass("o"+d);d++});$.getJSON("./inc/ajax.get.php?cb=?",e,function(a){showStatus(a)});createClasses()},onDragStart:function(a,b){a.start=$("#dnd tbody tr:first").attr("class")}})}function validate(a){console.time("profile");var b=a.find("input.required, textarea.required"),c=true,d={required:function(a,b){return{r:!!a,msg:"Nie sú výplnené povinné hodnoty"}},email:function(a,b){return{r:a.match(/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/),msg:"Neplatná e-mailová adresa"}},fiveplus:function(a,b){return{r:a.length>=5,msg:"Hodnota musí mať min. 5 znakov"}},numeric:function(a,b){return{r:!isNaN(a),msg:"Hodnota "+a+" nie je číslo."}},unique:function(a,b){var c={coll:b.attr("name"),id:$("input[name=id]").eq(0).val(),table:b.parents("form").eq(0).attr("name"),val:a,act:21};return{r:$.getCount(c),msg:"Hodnota <strong>"+a+"</strong> sa už v databáze nachádza."}}};b.removeClass("formerr");b.each(function(){var a=$(this),b=a.val(),e=a.attr("class").split(" ");for(i in e){if(d.hasOwnProperty(e[i])){var f=d[e[i]](b,a);if(!f.r){a.addClass("formerr");showStatus({err:1,msg:f.msg});c=false}}}});console.timeEnd("profile");return c}function renameArr(a){var b={};for(i in a){b[a[i].name]=a[i].value}return b}function showStatus(a){var b='<p class="'+(a.err===0?"ok":"err")+'">'+a.msg+"</p>",c=$("#status");c.html(b).center().fadeIn();setTimeout(function(){c.fadeOut(100)},4e3)}function createClasses(){$("tr:even").addClass("odd");$("tr:odd").removeClass("odd")}jQuery.extend({getCount:function(a){var b=false;$.ajax({url:"./inc/ajax.get.php",type:"get",data:a,dataType:"json",async:false,success:function(a){if(a.count===0)b=true}});return b}});$(function(){function f(a){$.get("./inc/ajax.get.php",a,function(b){$("#"+a.eid).html(b)});return false}function e(a){a=jQuery.parseJSON(a);var b=$("#avatars input[name=id]").val();if(a.err===0){for(var c=1;c<=3;c++){if(typeof a["avatar"+c]!="undefined"){f({act:11,img:a["avatar"+c],aid:b,eid:"avatar"+c})}}}showStatus(a);var d=$("#avatars");d.find("input[type=file]").val("");d.find(".file-holder").remove();d.find(".loader").fadeOut();return false}function d(a,b,c){if(a[0].value.length===0&&a[1].value.length===0&&a[2].value.length===0){showStatus({err:1,msg:"Nie je vybraný žiadny obrázok."});return false}$("#avatars .loader").fadeIn();return true}function c(a){$("#gallery").html(a);var b=$("#uploader");b.find("input[type=file]").val("");b.find(".file-holder").remove();b.find(".loader").fadeOut();return false}function b(a,b,c){var d=0;for(var e=0;e<5;e++){if(a[e].value.length===0){d+=1}else{var f=a[e].value.split(".").pop().toLowerCase();if($.inArray(f,["png","jpg","jpeg"])==-1){showStatus({err:1,msg:"Povolené sú len obrázky typu: png, jpg, jpeg"});return false}}}if(d===5){showStatus({err:1,msg:"Nie je vybraný žiadny obrázok."});return false}$("#uploader .loader").fadeIn();return true}var a="./inc/ajax.get.php?cb=?";createClasses();$("nav li.t").hover(function(){$(this).children("ul").show(200)},function(){$("nav ul ul").hide()});$(".f").prettyFileInput();$(".clickClear").click(function(){$(this).val("");return false});$("#gallery").delegate("#gallery a.del","click",function(b){var c=$(this),d={url:c.attr("title"),act:14};$.getJSON(a,d,function(a){if(a.err===1){showStatus(a);return false}c.parent(".ibox").fadeOut(300)})});$("#uploader").ajaxForm({success:c,beforeSubmit:b});$("#avatars").ajaxForm({datatype:"json",success:e,beforeSubmit:d});$("#avatars").delegate("#avatars a.del","click",function(){var b=$(this),c={id:b.attr("href").replace("#id",""),info:b.attr("title").split("#"),act:12};$.getJSON(a,c,function(a){if(a.err===1){showStatus(a);return false}$("#"+c.info[1]).html('<img src="./img/noavatar.png" alt="Nie je nahratý obrazok." />')})});$(".cbox").delegate(".ibox","mouseenter",function(){$(this).find("a").removeClass("hidden")});$(".cbox").delegate(".ibox","mouseleave",function(){$(this).find("a").addClass("hidden")});$("table.tc").delegate(".a1, .a0","click",function(b){var c=$(this),d={id:c.attr("href").replace("#id",""),act:1,table:c.parents("tbody").eq(0).attr("class"),status:c.hasClass("a1")?0:1};$.getJSON(a,d,function(a){if(a.err===0){c.removeClass().addClass("a"+d.status)}showStatus(a)});return false});$("table.tc").delegate(".del","click",function(b){var c=$(this),d={id:c.attr("href").replace("#id",""),act:3,table:c.parents("tbody").eq(0).attr("class")};if(!confirm("Skutočne chcete zmazať položku ID : "+d.id+" ?")){return false}$.getJSON(a,d,function(a){if(a.err===0){c.parent().parent().hide(1e3)}showStatus(a);createClasses()});return false});$("input[name=q]").autocomplete({focus:function(a,b){$("input[name=q]").val(b.item.label);return false},source:function(b,c){b.act=5;b.table=$("input[name=q]").attr("id");var d=b.table.split("-"),e=d[0]="id_"+d,f=d[1];$.getJSON(a,b,function(a){c($.map(a,function(a){return{label:a[f],value:a[f]}}))})},minLength:1,select:function(a,b){b.item.value}});$(".search").submit(function(){var b={q:$("input[name=q]").val(),table:$("#dnd").find("tbody").attr("class"),act:6};if(b.q.length===0){return false}$.getJSON(a,b,function(a){if(a.err===1){return false}$("#dnd tbody").html(a.html);$(".navigator").first().remove();$(".right .breadcrumb").html("<strong>Výsledky vyhľadávania: "+b.q+"</strong>");createClasses()});return false});$(".ajax").submit(function(){var b=$(this),c=b.serializeArray(),d=renameArr(c);if(!validate(b)){return false}$.getJSON(a,d,function(a){showStatus(a)});return false});$("form[name=add]").submit(function(){var b=$(this),c=b.serializeArray(),d=renameArr(c);if(!validate(b)){return false}$.getJSON(a,d,function(a){showStatus(a);if(a.err===0){b.find("input[type=text]").val("");b.find("input[type=password]").val("")}});return false});$("#help div a").hover(function(a){var b=$(this).attr("title");$('<img id="thumb" src="'+b+'" >').css("top",a.pageY-140).css("left",a.pageX+40).appendTo("body")},function(){$("#thumb").remove()});$("#help div a").mousemove(function(a){$("#thumb").css("top",a.pageY-140).css("left",a.pageX+40)})});(function(a){a.fn.prettyFileInput=function(b){var c={ihc:"file-input",bc:"btn2",abc:"btn-file-input",bac:"btn-file-input-active",ffhc:"file-holder",dt:"Vybrať foto",dfst:"Zmeniť výber"};var b=a.extend(c,b);return this.each(function(){var c=a(this);c.wrap('<span class="'+b.ihc+'"></span>');c.after('<span class="'+b.bc+" "+b.abc+'">'+b.dt+"</span>");c.bind("change focus click",function(){$val=c.val();valArray=$val.split("\\");newVal=valArray[valArray.length-1];$button=c.siblings("."+b.bc+"");$fakeHolder=c.siblings("."+b.ffhc+"");if(newVal!==""){$button.addClass(b.bac).html(b.dfst)}if($fakeHolder.length===0){c.parent().append('<span class="'+b.ffhc+'">'+newVal+"</span>")}else{$fakeHolder.text(newVal)}if($fakeHolder.length>0&&newVal===""){$fakeHolder.remove();$button.html(b.dt).removeClass().addClass(b.bc+" "+b.abc)}})})}})(jQuery);jQuery.fn.center=function(){this.css("position","absolute");this.css("top",($(window).height()-this.outerHeight())/2+$(window).scrollTop()+"px");this.css("left",($(window).width()-this.outerWidth())/2+$(window).scrollLeft()+"px");return this}